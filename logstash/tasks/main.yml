- name: establish dependencies 
  package:
    name: openjdk-8-jre-headless
    state: present
  tags: install

- name: establish logstash
  package:
    name: logstash
    state: present
  tags: install

- name: configure logstash port
  template:
    src: pipeline.conf.j2
    dest: "{{ logstash.config_path }}/{{ configuration.name | regex_replace('[^0-9a-zA-Z_]+', '_') }}.conf"
    mode: "u=rw,go=r"
  loop_control:
    loop_var: configuration
  with_items: "{{ pipeline_configuration }}"
  tags: configure

- name: initiate configured pipelines
  systemd:
    name: logstash
    enabled: yes
    state: restarted
  tags: configure

